language: clang

sudo: required
dist: trusty

branches:
  except:
    - release

branches:
  only:
    - master
    - develop

addons:
  apt:
    packages:
    - build-essential
    - cmake
    - gcc
    - lcov
    - devscripts
    - pbuilder
    - strace
    - lsof
    - gdb
    - valgrind
    - python
    - python-dev
    - python-pip
    - libffi-dev
    - doxygen
    - doxygen-latex

install:
  - pip install --user --upgrade pip
  - pip install --user cffi
  - export PATH=$PATH:$HOME/.local/bin

script:
  - mkdir -p target/build
  - cd target/build
  - cmake -D CMAKE_BUILD_TYPE=Coverage -D CMAKE_INSTALL_PREFIX=/opt/amcl -D WORD_LENGTH=64 -D USE_ANONYMOUS=on -D BUILD_WCC=on ../..
  - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:./
  - make
  - lcov --zerocounters --directory .
  - lcov --capture --initial --directory . --output-file coverage/amcl
  - make test
  - lcov --no-checksum --directory . --capture --output-file coverage/amcl.info
  - genhtml -o coverage -t "milagro-crypto-c Test Coverage" coverage/amcl.info
  - make doc
  - make clean
  - cmake -D CMAKE_INSTALL_PREFIX=/opt/amcl -D WORD_LENGTH=64 ../..
  - make
  - make test
